# æ¨¡å—åŒ–
- node è¯žç”Ÿä¹‹åŽï¼Œå‡ºçŽ°äº†å¤šç§å¤æ‚åœºæ™¯ï¼Œä¸ºäº†æé«˜ä»£ç å¤ç”¨çŽ‡ã€‚
- åªæœ‰å¯¼å‡ºçš„å˜é‡æ‰èƒ½è¢«å¤–éƒ¨ä½¿ç”¨ï¼Œä¸å½±å“å¤–éƒ¨çš„ä½œç”¨åŸŸã€‚

# æ¼”å˜è¿‡ç¨‹
## 1. å…¨å±€function
```js
// å°†ä¸åŒåŠŸèƒ½å°è£…æˆä¸åŒçš„å…¨å±€å‡½æ•°ã€‚
const a = () => {
    ...
}

const b = () => {
    ...
}

// é—®é¢˜ï¼šå‘½åæ±¡æŸ“ï¼Œæ•°æ®ä¸å®‰å…¨ï¼Œæ¨¡å—æˆå‘˜çœ‹ä¸å‡ºç›´æŽ¥å…³ç³»ã€‚
```

## 2. namespace
```js
// å¯¹è±¡çš„ç®€å•å°è£…ï¼Œå‡å°‘äº†å…¨å±€å˜é‡ï¼Œè§£å†³å‘½åå†²çªã€‚
const a = {
    _count : 0,
    a() {
        ...
    },
    b() {
        ...
    }
}

// é—®é¢˜ï¼šå¯ä»¥è®¿é—®å†…éƒ¨_countå±žæ€§
// ðŸŒ§ï¸ å¯ä»¥ä¿®æ”¹
```

## 3. IIFEæ¨¡å¼
- åŒ¿åå‡½æ•°è‡ªè°ƒç”¨ã€‚å°†æ•°æ®å’Œæ–¹æ³•å°è£…åˆ°ä¸€ä¸ªå‡½æ•°å†…éƒ¨ï¼Œé€šè¿‡ window å±žæ€§æš´éœ²å‡ºæ¥ã€‚æ•°æ®ç§æœ‰åŒ–ï¼Œåªèƒ½æ‹¿åˆ°æš´éœ²çš„æ–¹æ³•ã€‚
- é—®é¢˜ï¼šå¦‚æžœä¾èµ–å¦ä¸€ä¸ªæ¨¡å—ã€‚
```JS
const module1 = (function() {
    const _count = 1
  // ...
  //æš´éœ²è¡Œä¸º
  return {
    a,b
  }
})()
// _countè®¿é—®ä¸åˆ°
```
## 4. IIFE å¢žå¼º
- ä¸»è¦æ¨¡å¼
```JS
(function(module1) {
    mod.a = ...
    // ...
    //æš´éœ²è¡Œä¸º
    return mod;
})(module1)
// é™„åŠ ä¸€ä¸ªæ–°çš„aæ–¹æ³•ï¼›
```

## 5. æµè§ˆå™¨åŠ è½½ä¾èµ–é—®é¢˜
```js
var module1 = (function(mod){
    mod.a = ... // aä¾èµ–modï¼Œæµè§ˆå™¨ä¸­ï¼Œå¯èƒ½modæœªåŠ è½½
    // ...
    //æš´éœ²è¡Œä¸º
    return mod;
})(window.module1 || {}, Vue, ...)

// å…è®¸ä¼ å…¥ç©ºå¯¹è±¡
// åŒæ—¶ï¼Œä¼ å…¥ä¸åŒçš„ä¾èµ–åº“ï¼Œä¾èµ–å…³ç³»æ›´æ˜Žæ˜¾ï¼Œä¹Ÿä¿è¯å…¶ç‹¬ç«‹æ€§

// å¼‚æ­¥åŠ è½½é—®é¢˜ => AMD
```

# AMDè§„èŒƒ - Asynchronous Module Definition
- å¼‚æ­¥åŠ è½½ï¼Œä¾èµ–å‰ç½®ã€‚
- åŠ è½½å®Œä¾èµ–åŽç«‹å³æ‰§è¡Œä¾èµ–æ¨¡å—ï¼Œä¾èµ–åŠ è½½æˆåŠŸåŽæ‰§è¡Œå›žè°ƒ
```js
// æœ‰ä¾èµ–çš„æ¨¡å—
define(['module1', 'module2'], function(m1, m2) {
  return module
})
// å¼•å…¥
// require å‡½æ•°
require(['module1', 'module2'], function(m1, m2){
})
```
- RequireJSæä¾›defineï¼Œéµå¾ªè§„èŒƒå¥½å¤„ï¼š
1. æ‰§è¡Œé¡ºåºä¸ä¼šå‡ºé”™ã€‚
2. ä¸ä¼šå½±å“å…¨å±€çŽ¯å¢ƒã€‚

# CommonJS - require.js
## è§£å†³ï¼š
- å®žçŽ°jsæ–‡ä»¶çš„å¼‚æ­¥åŠ è½½ï¼Œé¿å…ç½‘é¡µå¤±åŽ»å“åº”ï¼›å¯¹ä»£ç è¿›è¡Œè§£æžï¼Œæ•´ç†å‡ºä»£ç ä¸­çš„æ‰€æœ‰æ¨¡å—ä¾èµ–å…³ç³»ï¼Œç›¸å…³çš„æ¨¡å—ä»£ç éƒ½æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œ `å½¢æˆä¸€ä¸ªå®Œæ•´çš„JSæ–‡ä»¶` ã€‚
- ç®¡ç†æ¨¡å—ä¹‹é—´çš„ä¾èµ–æ€§ï¼Œä¾¿äºŽä»£ç çš„ç¼–å†™å’Œç»´æŠ¤ã€‚
```js
require([module1, module2], function() {
    ...
})
// require()å¼‚æ­¥åŠ è½½moduleAï¼ŒmoduleBå’ŒmoduleCï¼Œæµè§ˆå™¨ä¸ä¼šå¤±åŽ»å“åº”ï¼›
// å®ƒæŒ‡å®šçš„å›žè°ƒå‡½æ•°ï¼Œåªæœ‰å‰é¢çš„æ¨¡å—éƒ½åŠ è½½æˆåŠŸåŽï¼Œæ‰ä¼šè¿è¡Œï¼Œè§£å†³äº†ä¾èµ–æ€§çš„é—®é¢˜ã€‚
```

## ç‰¹ç‚¹
- å½“ä¸€ä¸ªæ¨¡å—è¢«è„šæœ¬å¼•ç”¨åŽï¼Œé»˜è®¤ä¼šå¾—åˆ°ä¸€ä¸ªç©ºå¯¹è±¡ï¼›
```JS
// é»˜è®¤æƒ…å†µ
let lib = require('module') // lib = {}
```
- æ¨¡å—å†…å®¹å¯ä»¥é€šè¿‡ `exports.xx` å¯¼å‡ºï¼›
```JS
// æ¨¡å—A
exports.a = 'world'

// è„šæœ¬
let lib = require('module') // { a: 'world' }
```
- ä¸ä¼šå½±å“å…¨å±€ä½œç”¨åŸŸï¼›
- `ç¼“å­˜è¿è¡Œç»“æžœ`ï¼Œç¬¬äºŒæ¬¡ä¹‹åŽç›´æŽ¥è¯»å–ç¼“å­˜ç»“æžœï¼Œæƒ³è¦å†æ¬¡è¿è¡Œå¿…é¡»æ¸…é™¤ç¼“å­˜ã€‚
- æŒ‰ä»£ç ä¸­çš„é¡ºåºåŠ è½½ã€‚
```JS
// æš´éœ²æ¨¡å—
module.exports = value
exports.xxx = value // module.exports.xxx

// å¼•å…¥
// è¯»å…¥å¹¶æ‰§è¡Œä¸€ä¸ªJSæ–‡ä»¶ï¼Œè¿”å›žæ¨¡å—çš„çš„exportsï¼Œå¦‚æžœæ²¡æœ‰åˆ™æŠ¥é”™
require(xxx)
```
- æ¨¡å—å’Œè„šæœ¬å¯¼å‡ºçš„æ˜¯ `åŒä¸€ä¸ªå¼•ç”¨` ï¼Œå¤–é¢ä¹Ÿå¯ä»¥æ”¹å˜æ¨¡å—å¯¼å‡ºçš„å†…å®¹ã€‚
```JS
// æ¨¡å—A
exports.a = { name: 'Jess' }
setTimeout(() => { console.log(a) }, 2000) // Jess666

// è„šæœ¬
let lib = require('module') // { a: 'world' }
lib.a = 'Jess666'
```
- åœ¨å¯¼å‡ºä¸­ä¹Ÿå¯ä»¥è®© `module.exports` è¦†ç›–æŽ‰ä¹‹å‰å®šä¹‰çš„ `export` å¯¹è±¡;ä½†æ¨¡å—Aå†…éƒ¨ä½¿ç”¨çš„ `exports` è¿˜æ˜¯ `export` çš„ç›¸å…³å†…å®¹ï¼Œåªæ˜¯ ã€Œå¤–éƒ¨è®¿é—®åˆ°çš„æ˜¯ `module.exports` çš„å†…å®¹ã€ã€‚
```JS
// æ¨¡å—A
export.a = 'jess'
module.exports = function aa() {}
console.log(exports) // { a: jess }

// è„šæœ¬
let lib = require('module') // aa
lib.a // ä»æ—§æ˜¯module.exports
```
- ps: webpack å¯¹äºŽCJSçš„å®žçŽ°ï¼Œ`require`ä¼šæ›¿æ¢æŽ‰`module`ä¸‹é¢çš„`exports`å¼•ç”¨ã€‚ä½†å†…éƒ¨è¿˜å­˜ç•™ç€ `exports`ã€‚
![](/image/ed499f52f94469b646e543a3f9c64ef.png)

# CMDè§„èŒƒ
- æ¨¡å—å¼‚æ­¥ï¼Œå»¶è¿Ÿæ‰§è¡Œï¼Œå°±è¿‘ä¾èµ–ï¼Œå…ˆåŠ è½½æ‰€æœ‰ä¾èµ–æ¨¡å—ï¼Œè¿è¡Œæ—¶æ‰æ‰§è¡Œrequireå†…å®¹ï¼ŒæŒ‰é¡ºåºæ‰§è¡Œã€‚
```JS
// æ²¡æœ‰ä¾èµ–çš„æ¨¡å—
define(function(require, exports, module) {
  export.xxx = value
  module.exports = value
})
// æœ‰ä¾èµ–
define(function(require, exports, module) {
  // å¼•å…¥ä¾èµ–æ¨¡å—
  var module1 = require('./module1')
  // å¼•å…¥å¼‚æ­¥ä¾èµ–
  require.async('./module2', function(m3) {

  })
  // æš´éœ²æ¨¡å—
  exports.xxx = value
})

// å¼•å…¥æ¨¡å—
define(function(require) {
  var m1 = require('./module1')
  // ...
})
```

# ES6æ¨¡å—åŒ–
- ESMçš„å¯¹å¤–æŽ¥å£åªæ˜¯ä¸€ç§ `é™æ€å®šä¹‰`ï¼Œé‡åˆ°æ¨¡å—åŠ è½½å‘½ä»¤ `import` ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ª `åªè¯»å¼•ç”¨` ã€‚ç­‰è„šæœ¬çœŸæ­£æ‰§è¡Œæ—¶ï¼Œå†æ ¹æ®è¿™ä¸ªåªè¯»å¼•ç”¨ï¼Œåˆ°è¢«åŠ è½½çš„é‚£ä¸ªæ¨¡å—å†…å–å€¼ã€‚
```JS
// å¯¼å‡º
export const value = 1
// é»˜è®¤å¯¼å‡º
export default value
// å¯¼å…¥
import { value } from './module1.js'
```

# UMD
ä¸€ç§ Javascript é€šç”¨æ¨¡å—å®šä¹‰è§„èŒƒï¼Œè®©ä½ çš„æ¨¡å—èƒ½åœ¨ Javascript æ‰€æœ‰è¿è¡ŒçŽ¯å¢ƒä¸­å‘æŒ¥ä½œç”¨ã€‚ä¾‹å¦‚ï¼šAMDå’ŒCommonJSï¼ˆæœåŠ¡ç«¯æ¨¡å—åŒ–è§„èŒƒ)çš„ç»“åˆä½“ã€‚
```JS
(function(root, factory) {
  if (typeof define === 'function' && define.amd) {
    // AMD. Register as an anonymous module.
    define(['b'], factory)
  } else if (typeof module === 'object' && module.exports) {
    // Node. Does not work with strict CommonJS, but
    // only CommonJS-like environments that support module.exports,
    // like Node.
    module.exports = factory(require('b'))
  } else {
    // Browser globals (root is window)
    root.returnExports = factory(root.b)
  }
})(this, function(b) {
  // Just return a value to define the module export.
  // This example returns an object, but the module
  // can return a function as the exported value.
  return {}
})
```

# ESMä¸ŽcommonJSçš„å·®å¼‚ï¼š
## ESMï¼š
  - å€¼å¼•ç”¨ï¼Œåªè¯»
  - æ¨¡å—é‡Œå˜é‡ç»‘å®šæ‰€åœ¨çš„æ¨¡å—
  - åœ¨ä»£ç é™æ€è§£æžé˜¶æ®µå°±ä¼šç”Ÿæˆ
## CJSï¼šæ˜¯åœ¨ã€ŒåŠ è½½æ—¶æ‰§è¡Œã€ã€‚
  - å€¼æ‹·è´ã€‚
  - å¯ä»¥ç¼“å­˜å€¼ï¼Œä¿®æ”¹å€¼

## å¯¹äºŽå¾ªçŽ¯ä¾èµ–
- å…¶ä¸­ï¼Œå‡ºçŽ°å¾ªçŽ¯ä¾èµ–çš„æ¨¡å—ï¼Œä¼šè¢«å¤„ç†ä¸ºã€Œæœªå®ŒæˆçŠ¶æ€ã€ã€‚
- CJSï¼Œ ä¸€æ—¦å‡ºçŽ°äº†æŸä¸ªæ¨¡å—è¢«å¾ªçŽ¯åŠ è½½ï¼Œæ¨¡å—çš„å¯¼å…¥æ˜¯åŒæ­¥çš„ï¼Œä¼šç«‹å³æ‰§è¡Œæ¨¡å—çš„ä»£ç ï¼Œå› æ­¤å½“å‡ºçŽ°å¾ªçŽ¯ä¾èµ–æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªæ¨¡å—çš„å¯¼å‡ºå€¼è¿˜æ²¡æœ‰è¢«èµ‹å€¼ã€‚
- ESMï¼Œ å¾ªçŽ¯ä¾èµ–æ˜¯å…è®¸çš„ï¼Œå¦‚æžœå®ƒçš„å¯¼å‡ºè¿˜æ²¡æœ‰å®Œæˆï¼Œé‚£ä¹ˆå¯¼å…¥çš„å€¼ä¼šæ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ã€‚ç›´åˆ°å¯¼å‡ºå®ŒæˆåŽï¼Œå¯¼å…¥çš„å€¼æ‰ä¼šè¢«æ›´æ–°ã€‚

# å‚è€ƒæ–‡ç« 
> require.js: https://requirejs.org/

